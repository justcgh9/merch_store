# –ú–∞–≥–∞–∑–∏–Ω –º–µ—Ä—á–∞


[![Merch App CI](https://www.github.com/justcgh9/merch_store/actions/workflows/ci.yml/badge.svg)](https://www.github.com/justcgh9/merch_store/actions/workflows/ci.yml) [![Coverage Status](https://coveralls.io/repos/github/justcgh9/merch_store/badge.svg)](https://coveralls.io/github/justcgh9/merch_store)
## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–ù–∏–∂–µ** –í—ã –º–æ–∂–µ—Ç–µ –≤–∏–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:

---

```bash
    merch_store/
    ‚îú‚îÄ‚îÄ cmd
    ‚îÇ   ‚îî‚îÄ‚îÄ merch-store
    ‚îÇ       ‚îî‚îÄ‚îÄ main.go
    ‚îú‚îÄ‚îÄ config
    ‚îÇ   ‚îî‚îÄ‚îÄ local.yml
    ‚îú‚îÄ‚îÄ docker-compose.yml
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ go.mod
    ‚îî‚îÄ‚îÄ internal
        ‚îú‚îÄ‚îÄ config
        ‚îÇ   ‚îî‚îÄ‚îÄ config.go
        ‚îú‚îÄ‚îÄ http-server
        ‚îÇ   ‚îú‚îÄ‚îÄ handlers
        ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth
        ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.go
        ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buy
        ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ buy.go
        ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ info
        ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ info.go
        ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ send
        ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ send.go
        ‚îÇ   ‚îî‚îÄ‚îÄ middleware
        ‚îÇ       ‚îî‚îÄ‚îÄ auth
        ‚îÇ           ‚îî‚îÄ‚îÄ auth.go
        ‚îú‚îÄ‚îÄ models
        ‚îÇ   ‚îú‚îÄ‚îÄ inventory
        ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ inventory.go
        ‚îÇ   ‚îú‚îÄ‚îÄ transaction
        ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transaction.go
        ‚îÇ   ‚îî‚îÄ‚îÄ user
        ‚îÇ       ‚îî‚îÄ‚îÄ user.go
        ‚îú‚îÄ‚îÄ services
        ‚îÇ   ‚îú‚îÄ‚îÄ coin
        ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ coin.go
        ‚îÇ   ‚îú‚îÄ‚îÄ merch
        ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ merch.go
        ‚îÇ   ‚îî‚îÄ‚îÄ user
        ‚îÇ       ‚îî‚îÄ‚îÄ user.go
        ‚îî‚îÄ‚îÄ storage
            ‚îú‚îÄ‚îÄ postgres
            ‚îÇ   ‚îî‚îÄ‚îÄ postgres.go
            ‚îî‚îÄ‚îÄ storage.go

```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–π

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í –Ω–∞—à–µ–º PostgreSQL-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ç—ã—Ä–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

- **Users** ‚Äì —Ö—Ä–∞–Ω–∏—Ç –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –ø–∞—Ä–æ–ª–∏.
- **Balance** ‚Äì –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- **Inventory** ‚Äì —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- **History** ‚Äì —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

–ü—Ä–æ—Å—Ç–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```
    +-------------+       +------------+ 
    |   Users     |       |  Balance   |
    |-------------|       |------------|
--> | username PK | <---> | username PK|
|   | password    |       | balance    |
|   +-------------+       +------------+
|
|   +------------+       +---------------------------+
|   | Inventory  |       |         History           |
|   |------------|       |---------------------------|
--> | username PK| <---> | from_user FK -> Users     |
    | t-shirt    |       | to_user   FK -> Users     |
    | cup        |       | amount                    |
    | book       |       +---------------------------+
    | ...        |
    +------------+
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **golang-migrate**.

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–ß—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```sh
go run cmd/migrator/main.go -db "postgres://merch_user:merch_password@localhost:5432/merch_db?sslmode=disable" -path "./migrations" -action up
```

#### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

–î–ª—è –æ—Ç–∫–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```sh
go run cmd/migrator/main.go -db "postgres://merch_user:merch_password@localhost:5432/merch_db?sslmode=disable" -path "./migrations" -action down
```

### –ó–∞–ø—É—Å–∫ PostgreSQL —á–µ—Ä–µ–∑ Docker

–ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã:

```sh
docker-compose up -d postgres
```

–≠—Ç–æ—Ç –∑–∞–ø—É—Å–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ `docker-compose.yml`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 5432 —Å–≤–æ–±–æ–¥–µ–Ω, –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞ –¥—Ä—É–≥–æ–π –≤ —è–º–ª–µ.

---

–° —ç—Ç–∏–º –Ω–∞–±–æ—Ä–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤—ã –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. üöÄ


